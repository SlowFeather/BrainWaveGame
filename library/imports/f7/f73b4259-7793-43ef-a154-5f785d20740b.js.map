{"version":3,"sources":["assets\\scripts\\Game\\BrainGameScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {\n    MessageDef\n} from \"../Def/MessageDef\";\nimport {\n    BrainModel\n} from \"../Manager/DriveManager/DriveManager\";\nimport MessageDispatcher from \"../Manager/MessageDispatcher/MessageDispatcher\";\nimport SoundManager from \"../Manager/SoundManager\";\nimport UserManager from \"../Manager/UserManager/UserManager\";\nimport ResUtil from \"../Tools/ResUtil\";\nimport ConstellationScript from \"./Constellation/ConstellationScript\";\n\nconst {\n    ccclass,\n    property\n} = cc._decorator;\n\n@ccclass\nexport default class BrainGameScene extends cc.Component {\n\n\n    @property({\n        type: [String]\n    })\n    AllAnimationNames: string[] = [];\n\n    @property({\n        type: cc.Node\n    })\n    SceneCamera: cc.Node;\n\n\n\n    @property({\n        type: [ConstellationScript]\n    })\n    AllStarScript: ConstellationScript[] = [];\n\n    /**\n     * 当前正在执行的星座脚本\n     *\n     * @type {ConstellationScript}\n     * @memberof BrainGameScene\n     */\n    NowStarScript: ConstellationScript = null;\n\n    BackgroundObject: cc.Node;\n\n    /**\n     * 是否正在切换星座动画中\n     *\n     * @type {boolean}\n     * @memberof BrainGameScene\n     */\n    SwitchAnimationPlaying: boolean = false;\n\n\n    /**\n     * 固定值，甲方定的\n     *\n     * @type {number}\n     * @memberof BrainGameScene\n     */\n    RelaxationValue: number = 55.51;\n\n    onLoad() {\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainGameStart, this.BrainGameStartHandler, this);\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainGameEnd, this.BrainGameEndHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainValueChangeMessage, this.BrainValueChangeMessageHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.ConstellationAnimationEnd, this.ConstellationAnimationEndHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainBlockMessage, this.BrainBlockMessageHandler, this);\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainNotConnectMessage, this.BrainNotConnectMessageHandler, this);\n\n    }\n\n\n    onDestroy() {\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainGameStart, this.BrainGameStartHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainGameEnd, this.BrainGameEndHandler, this);\n\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainValueChangeMessage, this.BrainValueChangeMessageHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.ConstellationAnimationEnd, this.ConstellationAnimationEndHandler, this);\n\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainBlockMessage, this.BrainBlockMessageHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainNotConnectMessage, this.BrainNotConnectMessageHandler, this);\n    }\n\n\n    start() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    }\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n                if (this.SwitchAnimationPlaying) {\n                    console.log(\"当前正在播放切换星座动画\");\n\n                    return;\n                }\n                this.NowStarScript.PlayNextStar();\n                console.log('按了A');\n                break;\n        }\n    }\n\n    BrainBlockMessageHandler() {\n                    //清空两个数字\n                    // for (let index = 0; index < this.valueSumList.length; index++) {\n                    //     this.valueSumList[index]=0;\n                    // }\n    }\n    BrainNotConnectMessageHandler() {\n                    //清空两个数字\n                    // for (let index = 0; index < this.valueSumList.length; index++) {\n                    //     this.valueSumList[index]=0;\n                    // }\n    }\n\n    // value1:number=0;\n    // value2:number=0;\n    valueSumList: number[] = [0, 0]\n\n    // valueCount=0;\n    /**\n     * 拿到一次数据，这里要判断值\n     *\n     * @param {BrainModel} module\n     * @memberof BrainGameScene\n     */\n    BrainValueChangeMessageHandler(module: BrainModel) {\n\n        // if (this.NowStarScript.playing) {\n        //     return;\n        // }\n        // if (this.SwitchAnimationPlaying) {\n        //     return;\n        // }\n        // this.valueCount++;\n        // console.log(this.valueCount);\n        \n        if (this.valueSumList[0] == 0) {\n            this.valueSumList[0] = Number(module.brain[0].Concentration);\n            this.valueSumList[1] = 0;\n            //console.log(\"-1-> \" + this.valueSumList[0] + \"--\" + this.valueSumList[1]);\n            return;\n\n        } else {\n            if (this.valueSumList[1] == 0) {\n                this.valueSumList[1] = Number(module.brain[0].Concentration);\n                //判断值有没有超过阈值，然后调用\n                // if (Number(module.brain[0].Relaxation)>=this.RelaxationValue) {\n                //     this.NowStarScript.PlayNextStar();\n                // }\n                if (((this.valueSumList[0] + this.valueSumList[1]) / 2) >= this.RelaxationValue) {\n                    //console.log(\"-2-> \" + this.valueSumList[0] + \"--\" + this.valueSumList[1]);\n\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n\n                    if (this.NowStarScript!=null) {\n                        //console.log(\"开始播放下一个星星动画\");\n                        //旧版逻辑\n                        this.NowStarScript.PlayNextStar();\n\n                    }\n                    \n\n                } else {\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n                    this.valueSumList.forEach(element => {\n                        element = 0;\n                    });\n                }\n            }\n        }\n    }\n\n    BrainGameStartHandler() {\n        console.log(\"开始创建地形\");\n        // this.valueCount=0;\n        this.SceneCamera.position = new cc.Vec3(334.282, 174.654);\n\n        this.SwitchAnimationPlaying = false;\n\n        this.valueSumList = [0, 0];\n\n        //创建地形\n        ResUtil.LoadPrefab(\"Background\", (res) => {\n            this.BackgroundObject = res;\n            //获取所有星座组件\n            this.AllStarScript = this.node.getChildByName(\"Background\").getComponentsInChildren(ConstellationScript);\n            console.log(\"一共是多少个星星：\" + this.AllStarScript.length);\n            //把所有的都初始化\n            this.AllStarScript.forEach(element => {\n                element.InitAllAnimation();\n                if (element.constellationNumber == 0) {\n                    this.NowStarScript = element;\n                }\n            });\n        });\n    }\n\n    BrainGameEndHandler() {\n        this.BackgroundObject.destroy();\n        this.SwitchAnimationPlaying = false;\n    }\n\n    /**\n     * 星座动画播放完了，需要切换到下一个星座\n     *\n     * @param {number} num\n     * @return {*} \n     * @memberof BrainGameScene\n     */\n    ConstellationAnimationEndHandler(num: number) {\n\n        if (num + 1 >= 5) {\n            console.log(\"超过最大星座限制\");\n            return;\n        } else {\n            //当前星座+1\n\n            //切换到下一个，然后播放动画\n            this.SwitchNextAnimation(num + 1);\n        }\n    }\n\n    /**\n     * 切换到下一个星座的动画\n     *\n     * @param {number} nextnumber\n     * @memberof BrainGameScene\n     */\n    SwitchNextAnimation(nextnumber: number) {\n        this.SwitchAnimationPlaying = true;\n        SoundManager.playEffect(4);\n\n        this.SceneCamera.getComponent(cc.Animation).play(this.AllAnimationNames[this.NowStarScript.constellationNumber]);\n        this.SceneCamera.getComponent(cc.Animation).on(\"finished\", this.SwitchAnimationEnd, this);\n    }\n    SwitchAnimationEnd() {\n\n        this.SceneCamera.getComponent(cc.Animation).off(\"finished\", this.SwitchAnimationEnd, this);\n        console.log(\"切换动画结束\" +(Number(this.NowStarScript.constellationNumber)  + 1));\n\n        this.NowStarScript = this.AllStarScript[this.NowStarScript.constellationNumber + 1];\n        this.SwitchAnimationPlaying = false;\n\n        //自动播放第一个\n        // this.StartStarAnimation();\n    }\n}"]}