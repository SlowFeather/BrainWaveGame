{"version":3,"sources":["assets\\scripts\\UI\\LoadingUI\\LoadingUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { UIDef } from \"../../Def/UIDef\";\nimport Game from \"../../Game\";\nimport SoundManager from \"../../Manager/SoundManager\";\n\n\nimport ResUtil from \"../../Tools/ResUtil\";\nimport { TimeUtil } from \"../../Tools/TimeUtil\";\nimport UIUtil from \"../../Tools/UIUtil\";\nimport { SoundTableData } from \"../../StaticDatas/SoundTableData\";\nimport { PreLoadCsvSync } from \"../../Tools/TableReader\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class LoadingUI extends cc.Component {\n\n    /**\n     * 进度条\n     *\n     * @type {cc.ProgressBar}\n     * @memberof LoadingUI\n     */\n    @property({\n        type: cc.ProgressBar,\n        tooltip: \"进度条\"\n    })\n    loadbar_progressbar: cc.ProgressBar = null;\n\n\n    /**\n     * 当前进度\n     *\n     * @type {cc.Label}\n     * @memberof LoadingUI\n     */\n    @property({\n        type: cc.Label,\n        tooltip: \"当前进度\"\n    })\n    loadbar_txt: cc.Label = null;\n\n\n\n    /**\n     * 进度条进度\n     *\n     * @memberof LoadingUI\n     */\n    _processingValue = 0;\n\n    /**\n     * 进度条动画进度\n     *\n     * @memberof LoadingUI\n     */\n    _processingTweenValue = 0;\n\n\n    start() {\n        this.LoadAssets();\n    }\n    async LoadAssets() {\n        this._processingValue = 0;\n        //先加载表\n        this.LoadTable();\n        this.LoadRes();\n    }\n    async LoadRes() {\n        //加载所有UIPrefabs\n        await ResUtil.LoadDir(\"prefabs/ui\", (assets) => {\n            assets.forEach(element => {\n                ResUtil.ResDictionary[element.name] = element;\n            });\n            this._processingValue += 10;\n            console.log(\"-->所有UIPrefabs加载完毕,共有\" + assets.length + \"个\");\n        },()=>{\n            console.log(\"-->加载UIPrefabs出现问题\");\n        });\n\n        //加载所有GamePrefabs\n        await ResUtil.LoadDir(\"prefabs/game\", (assets) => {\n            assets.forEach(element => {\n                ResUtil.ResDictionary[element.name] = element;\n            });\n            this._processingValue += 10;\n            console.log(\"-->所有GamePrefabs加载完毕,共有\" + assets.length + \"个\");\n\n        },()=>{\n            console.log(\"-->加载GamePrefabs出现问题\");\n        });\n\n    }\n    //表占80%\n    async LoadTable() {\n        let tables = this.getFilesByPath('StaticDatas/', cc.TextAsset);\n        let tableCount = tables.length;\n        for (let i = 0; i < tableCount; i++) {\n            await PreLoadCsvSync(tables[i], (ret) => {\n                if (ret) {\n                    this._processingValue += (1 / tableCount) * 80;\n                } else {\n                    console.log(\"Load Table Error!\");\n                }\n            });\n        }\n    }\n\n    ShowStartUI() {\n\n        //显示开始界面\n        // console.log(SoundTableData.getById(1));\n\n        // console.log(SoundTableData.getById(1).path);\n        // let asset = cc.loader.getRes(\"StaticDatas/DescribeTableData\", cc.TextAsset);\n        // console.dir(asset);\n\n        UIUtil.ShowUI(UIDef.StartUI, () => {\n            UIUtil.RemoveUI(UIDef.LoadingUI);\n        });\n\n        // this.InitData();\n    }\n    update(dt) {\n        if (this._processingTweenValue < this._processingValue) {\n            //限制速度\n            if (this._processingValue - this._processingTweenValue > 20) {\n                this._processingTweenValue += 1.2;\n            } else {\n                this._processingTweenValue += 0.8;\n            }\n\n            if (this._processingTweenValue >= 100) {\n                console.log(\"-->所有资源加载完毕\");\n                this.ShowStartUI();\n                return;\n            }\n            this.loadbar_progressbar.progress = this._processingTweenValue / 100\n            this.loadbar_txt.string = \"加载进度：\" + Math.ceil(this._processingTweenValue) + \"%\"\n        }\n    }\n    getFilesByPath(url, type) {\n        url = url || '';\n        var urls = [];\n        var assetTables = cc.loader['_assetTables'];\n        var uuids = assetTables['assets']['getUuidArray'](url, type, urls);\n        return urls;\n    }\n}\n"]}