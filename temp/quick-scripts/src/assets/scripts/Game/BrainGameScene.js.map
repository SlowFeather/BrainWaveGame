{"version":3,"sources":["assets\\scripts\\Game\\BrainGameScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import {\n    MessageDef\n} from \"../Def/MessageDef\";\nimport {\n    BrainModel\n} from \"../Manager/DriveManager/DriveManager\";\nimport MessageDispatcher from \"../Manager/MessageDispatcher/MessageDispatcher\";\nimport SoundManager from \"../Manager/SoundManager\";\nimport UserManager from \"../Manager/UserManager/UserManager\";\nimport ResUtil from \"../Tools/ResUtil\";\nimport ConstellationScript from \"./Constellation/ConstellationScript\";\n\nconst {\n    ccclass,\n    property\n} = cc._decorator;\n\n@ccclass\nexport default class BrainGameScene extends cc.Component {\n\n\n    @property({\n        type: [String]\n    })\n    AllAnimationNames: string[] = [];\n\n    @property({\n        type: cc.Node\n    })\n    SceneCamera: cc.Node;\n\n\n\n    @property({\n        type: [ConstellationScript]\n    })\n    AllStarScript: ConstellationScript[] = [];\n\n    /**\n     * 当前正在执行的星座脚本\n     *\n     * @type {ConstellationScript}\n     * @memberof BrainGameScene\n     */\n    NowStarScript: ConstellationScript = null;\n\n    BackgroundObject: cc.Node;\n\n    /**\n     * 是否正在切换星座动画中\n     *\n     * @type {boolean}\n     * @memberof BrainGameScene\n     */\n    SwitchAnimationPlaying: boolean = false;\n\n\n    /**\n     * 固定值，甲方定的\n     *\n     * @type {number}\n     * @memberof BrainGameScene\n     */\n    RelaxationValue: number = 55.51;\n\n    onLoad() {\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainGameStart, this.BrainGameStartHandler, this);\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainGameEnd, this.BrainGameEndHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainValueChangeMessage, this.BrainValueChangeMessageHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.ConstellationAnimationEnd, this.ConstellationAnimationEndHandler, this);\n\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainBlockMessage, this.BrainBlockMessageHandler, this);\n        MessageDispatcher.Instance.AddEventListener(MessageDef.BrainNotConnectMessage, this.BrainNotConnectMessageHandler, this);\n\n    }\n\n\n    onDestroy() {\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainGameStart, this.BrainGameStartHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainGameEnd, this.BrainGameEndHandler, this);\n\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainValueChangeMessage, this.BrainValueChangeMessageHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.ConstellationAnimationEnd, this.ConstellationAnimationEndHandler, this);\n\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainBlockMessage, this.BrainBlockMessageHandler, this);\n        MessageDispatcher.Instance.RemoveEventListener(MessageDef.BrainNotConnectMessage, this.BrainNotConnectMessageHandler, this);\n    }\n\n\n    start() {\n        // this.baiyang.armature().addEventListener(dragonBones.EventObject.COMPLETE,this.AnimationEventHandler,this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    }\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n                if (this.SwitchAnimationPlaying) {\n                    console.log(\"当前正在播放切换星座动画\");\n\n                    return;\n                }\n                this.NowStarScript.PlayNextStar();\n                console.log('按了A');\n                break;\n        }\n    }\n\n\n    BrainBlockMessageHandler() {\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n    }\n    BrainNotConnectMessageHandler() {\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n    }\n\n    // value1:number=0;\n    // value2:number=0;\n    valueSumList: number[] = [0, 0]\n\n    /**\n     * 拿到一次数据，这里要判断值\n     *\n     * @param {BrainModel} module\n     * @memberof BrainGameScene\n     */\n    BrainValueChangeMessageHandler(module: BrainModel) {\n\n        // console.log(\"--> \" + this.valueSumList[0] + \"--\" + this.valueSumList[1]);\n\n        if (this.valueSumList[0] == 0) {\n            this.valueSumList[0] = Number(module.brain[0].Relaxation);\n            this.valueSumList[1] = 0;\n            return;\n        } else {\n            if (this.valueSumList[1] == 0) {\n                this.valueSumList[1] = Number(module.brain[0].Relaxation);\n                //判断值有没有超过阈值，然后调用\n                // if (Number(module.brain[0].Relaxation)>=this.RelaxationValue) {\n                //     this.NowStarScript.PlayNextStar();\n                // }\n                if (((this.valueSumList[0] + this.valueSumList[1]) / 2) >= this.RelaxationValue) {\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n\n                    this.NowStarScript.PlayNextStar();\n\n                } else {\n                    //清空两个数字\n                    for (let index = 0; index < this.valueSumList.length; index++) {\n                        this.valueSumList[index]=0;\n                    }\n                    this.valueSumList.forEach(element => {\n                        element = 0;\n                    });\n                }\n            }\n        }\n    }\n    BrainGameStartHandler() {\n        console.log(\"开始创建地形\");\n        this.SceneCamera.position = new cc.Vec3(334.282, 174.654);\n\n        this.SwitchAnimationPlaying = false;\n\n        this.valueSumList = [0, 0];\n\n        //创建地形\n        ResUtil.LoadPrefab(\"Background\", (res) => {\n            this.BackgroundObject = res;\n            //获取所有星座组件\n            this.AllStarScript = this.node.getChildByName(\"Background\").getComponentsInChildren(ConstellationScript);\n            console.log(\"一共是多少个星星：\" + this.AllStarScript.length);\n            //把所有的都初始化\n            this.AllStarScript.forEach(element => {\n                element.InitAllAnimation();\n                if (element.constellationNumber == 0) {\n                    this.NowStarScript = element;\n                    //从第一颗星星开始播放动画\n                    //this.StartStarAnimation();\n                    //return;\n\n                }\n\n            });\n            // this.AllStarScript[0]\n        });\n    }\n\n    BrainGameEndHandler() {\n        this.BackgroundObject.destroy();\n        this.SwitchAnimationPlaying = false;\n\n    }\n\n    /**\n     * 星座动画播放完了，需要切换到下一个星座\n     *\n     * @param {number} num\n     * @return {*} \n     * @memberof BrainGameScene\n     */\n    ConstellationAnimationEndHandler(num: number) {\n        if (num + 1 >= 5) {\n            console.log(\"超过最大星座限制\");\n            return;\n        } else {\n            //当前星座+1\n            UserManager.Instance.CurrentConstellationNumber += 1;\n\n            //切换到下一个，然后播放动画\n            this.SwitchNextAnimation(num + 1);\n        }\n    }\n\n    /**\n     * 让当前星座开始播放动画\n     *\n     * @memberof BrainGameScene\n     */\n    StartStarAnimation() {\n        if (this.NowStarScript == null) {\n            console.log(\"当前星座丢失\");\n            return;\n        }\n        this.NowStarScript.StartAnimation();\n    }\n\n    /**\n     * 切换到下一个星座的动画\n     *\n     * @param {number} nextnumber\n     * @memberof BrainGameScene\n     */\n    SwitchNextAnimation(nextnumber: number) {\n        this.SwitchAnimationPlaying = true;\n        //这里等1s\n        setTimeout(() => {\n            SoundManager.playEffect(4);\n\n            this.SceneCamera.getComponent(cc.Animation).play(this.AllAnimationNames[this.NowStarScript.constellationNumber]);\n            this.SceneCamera.getComponent(cc.Animation).on(\"finished\", this.SwitchAnimationEnd, this);\n        }, 1000);\n    }\n    SwitchAnimationEnd() {\n\n        this.SceneCamera.getComponent(cc.Animation).off(\"finished\", this.SwitchAnimationEnd, this);\n        console.log(\"切换动画结束\" + this.NowStarScript.constellationNumber + 1);\n\n        this.NowStarScript = this.AllStarScript[this.NowStarScript.constellationNumber + 1];\n        this.SwitchAnimationPlaying = false;\n\n        //自动播放第一个\n        // this.StartStarAnimation();\n    }\n    // update (dt) {}\n}"]}