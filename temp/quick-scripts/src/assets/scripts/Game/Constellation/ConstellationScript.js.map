{"version":3,"sources":["assets\\scripts\\Game\\Constellation\\ConstellationScript.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { MessageDef } from \"../../Def/MessageDef\";\nimport MessageDispatcher from \"../../Manager/MessageDispatcher/MessageDispatcher\";\nimport SoundManager from \"../../Manager/SoundManager\";\nimport UserManager from \"../../Manager/UserManager/UserManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ConstellationScript extends cc.Component {\n\n    // @property({\n    //     type:dragonBones.ArmatureDisplay,\n    //     tooltip:\"龙骨组件\"\n    // })\n    // constellationArmatureDisplay:dragonBones.ArmatureDisplay;\n\n    @property({\n        type:Number,\n        tooltip:\"编号\"\n    })\n    constellationNumber:number=0;\n\n    @property({\n        type:[cc.Animation],\n        tooltip:\"全部组件\"\n    })\n    allAnimation:cc.Animation[]=[];\n\n\n    /**\n     * 当前播放到第几个动画\n     *\n     * @type {number}\n     * @memberof ConstellationScript\n     */\n    currentAnimationNumber:number=0;\n\n\n    /**\n     * 当前是否正在播放动画\n     *\n     * @type {boolean}\n     * @memberof ConstellationScript\n     */\n    playing:boolean=false;\n\n    start () {\n        // this.constellationArmatureDisplay.armature().addEventListener(dragonBones.EventObject.COMPLETE,this.AnimationEventHandler,this);\n        // this.constellationArmatureDisplay.armature().addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this.AnimationEventHandler,this);\n        // this.constellationArmatureDisplay.armature().addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this.AnimationEventHandler,this);\n\n    }\n    //============================================================================================\n    // NewPlayStar(){\n    //     this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Start\");\n    //     this.allAnimation[this.currentAnimationNumber].node.active=true;\n    //     this.currentAnimationNumber++;\n    //     this.allAnimation[this.currentAnimationNumber].once('finished',()=>{\n    //         if (this.allAnimation[this.currentAnimationNumber].currentClip.name==\"TianChengStar_Start\") {\n    //             this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Idle\");\n    //         }\n    //     },this);\n    // }\n\n\n    //===========================================================================================\n    /**\n     * 初始化所有动画，相当于把所有子物体透明度都变成0\n     *\n     * @memberof ConstellationScript\n     */\n    InitAllAnimation(){\n        this.allAnimation.forEach(element => {\n            // console.log(element.node.name);\n            element.node.opacity=0;\n            \n        });\n    }\n    /**\n     * 开始播放第一个动画\n     *\n     * @memberof ConstellationScript\n     */\n    // StartAnimation(){\n\n    //     this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Start\");\n    //     this.allAnimation[this.currentAnimationNumber].node.active=true;\n\n    //     this.allAnimation[this.currentAnimationNumber].on('finished',this.OnFinished,this);\n    // }\n\n    OnFinished(){\n\n        //console.log(\"播完了\"+this.allAnimation[this.currentAnimationNumber].currentClip.name);\n        this.playing=false;\n\n        //先取消 监听\n        this.allAnimation[this.currentAnimationNumber].off('finished',this.OnFinished,this);\n\n        if (this.allAnimation[this.currentAnimationNumber].currentClip.name==\"TianChengStar_Start\") {\n            this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Idle\");\n            this.currentAnimationNumber++;\n  \n            return;\n        }\n    }\n\n    PlayNextStar(){\n        if (this.playing) {\n            console.error(\"当前正在播放动画\");\n            return;\n        }\n\n\n        //检查是不是最后一个，如果是则发消息\n        if (this.currentAnimationNumber>=this.allAnimation.length) {\n            //console.log(\"当前星座所有动画播放完毕,增加星座计数\");\n            UserManager.Instance.CurrentConstellationNumber += 1;\n\n            MessageDispatcher.Instance.Dispatch(MessageDef.ConstellationAnimationEnd,this.constellationNumber);\n            return;\n        }\n\n        //如果是第一种动画\n        // if (this.currentAnimationNumber==0) {\n        //     this.playing=true;\n            \n        //     this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Start\");\n        //     this.allAnimation[this.currentAnimationNumber].node.active=true;\n\n        //     this.allAnimation[this.currentAnimationNumber].on('finished',this.OnFinished,this);\n\n        //     return;\n        // }\n\n        // this.currentAnimationNumber++;\n        \n        this.playing=true;\n        SoundManager.playEffect(3);\n        UserManager.Instance.CurrentStarNumber += 1;\n\n        if (this.allAnimation==null) {\n            return;\n        }\n        if (this.allAnimation[this.currentAnimationNumber]==null) {\n            return;\n        }\n        \n        this.allAnimation[this.currentAnimationNumber].play(\"TianChengStar_Start\");\n        this.allAnimation[this.currentAnimationNumber].on('finished',this.OnFinished,this);\n        this.allAnimation[this.currentAnimationNumber].node.active=true;\n    }\n\n\n    onDestroy(){\n        // if (this.constellationArmatureDisplay==null) {\n        //     return;\n        // }\n        // this.constellationArmatureDisplay.armature().removeEventListener(dragonBones.EventObject.COMPLETE,this.AnimationEventHandler,this);\n        // this.constellationArmatureDisplay.armature().removeEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this.AnimationEventHandler,this);\n        // this.constellationArmatureDisplay.armature().removeEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this.AnimationEventHandler,this);\n    }\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {}\n\n\n\n    // update (dt) {}\n}\n"]}